
<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="theme-color" content="#2a7a64">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("service-worker.js");
      });
    }
  </script>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <title>💚 Heart-Healthy Dinners & Grocery List</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #2d3748;
      margin: 0;
      padding: 1rem;
      min-height: 100vh;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }
    
    h1 {
      color: #4a5568;
      font-size: 2.5rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 2rem;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    h2 {
      color: #2d3748;
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }
    .meal, .grocery {
      background: linear-gradient(145deg, #ffffff, #f8fafc);
      border: none;
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .meal::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea, #764ba2);
    }
    
    .meal:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
    }
    
    .grocery {
      background: linear-gradient(145deg, #f0fff4, #e6fffa);
      border-left: 4px solid #48bb78;
    }
    .instructions {
      display: none;
      margin-top: 1rem;
    }
    .toggle-btn {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      padding: 0.6rem 1.2rem;
      transition: all 0.3s ease;
      box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
    }
    
    .toggle-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
  
    .remove-btn {
      margin-left: 1rem;
      background: linear-gradient(135deg, #ff6b6b, #ee5a24);
      color: white;
      border: none;
      border-radius: 50%;
      padding: 0.3rem;
      cursor: pointer;
      width: 24px;
      height: 24px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      transition: all 0.3s ease;
    }
    
    .remove-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);
    }
    .swap-btn {
      padding: 0.6rem 1.2rem;
      background: linear-gradient(135deg, #ff6b6b, #ee5a24);
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      margin-left: 1rem;
      font-weight: 500;
      font-size: 0.9rem;
      transition: all 0.3s ease;
      box-shadow: 0 2px 10px rgba(255, 107, 107, 0.3);
    }
    
    .swap-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
    }
    
    .swap-btn:disabled {
      background: #cbd5e0;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }
    
    .grocery-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .grocery-controls {
      display: flex;
      gap: 0.5rem;
    }
    
    .grocery-controls button {
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 20px;
    }
    
    .grocery-add-section {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      position: sticky;
      top: 0;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 1rem;
      border-radius: 12px;
      z-index: 10;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .add-btn {
      background: linear-gradient(135deg, #48bb78, #38a169);
      white-space: nowrap;
      min-width: 80px;
    }
    
    .grocery-stats {
      text-align: center;
      color: #718096;
      font-size: 0.9rem;
      margin-bottom: 1rem;
      padding: 0.5rem;
      background: rgba(113, 128, 150, 0.1);
      border-radius: 20px;
    }
    
    .grocery-list {
      display: grid;
      gap: 0.3rem;
      max-height: 60vh;
      overflow-y: auto;
      padding: 0.5rem;
      border-radius: 12px;
      background: rgba(248, 250, 252, 0.5);
    }
    
    .grocery-item {
      display: flex;
      align-items: center;
      padding: 1rem;
      background: white;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      transition: all 0.2s ease;
      touch-action: manipulation;
      min-height: 60px;
    }
    
    .grocery-item:hover {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }
    
    .grocery-item.checked {
      opacity: 0.6;
      background: #f0fff4;
    }
    
    .grocery-item.checked label {
      text-decoration: line-through;
      color: #68d391;
    }
    
    .grocery-item input[type="checkbox"] {
      margin-right: 1rem;
      transform: scale(1.5);
      accent-color: #48bb78;
      cursor: pointer;
    }
    
    .grocery-item label {
      flex: 1;
      font-weight: 400;
      cursor: pointer;
      font-size: 1rem;
      line-height: 1.4;
      word-break: break-word;
    }
    
    .instructions {
      background: #f8fafc;
      border-radius: 12px;
      padding: 1.5rem;
      margin-top: 1rem;
    }
    
    .instructions ol {
      margin: 0;
      padding-left: 1.5rem;
    }
    
    .instructions li {
      margin-bottom: 0.8rem;
      line-height: 1.6;
      color: #4a5568;
    }
    
    .api-config {
      background: linear-gradient(135deg, #fff3cd, #ffeaa7);
      border: none;
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 4px 20px rgba(255, 193, 7, 0.2);
    }
    
    .api-config h3 {
      margin-top: 0;
      color: #856404;
      font-weight: 600;
    }
    input[type="text"], input[type="password"] {
      padding: 0.8rem 1rem;
      margin-top: 1rem;
      margin-right: 0.5rem;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      width: 70%;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: white;
    }
    
    input[type="text"]:focus, input[type="password"]:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    button {
      padding: 0.8rem 1.5rem;
      background: linear-gradient(135deg, #48bb78, #38a169);
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 500;
      font-size: 1rem;
      transition: all 0.3s ease;
      box-shadow: 0 2px 10px rgba(72, 187, 120, 0.3);
    }
    
    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
    }
    
    @media (max-width: 768px) {
      body {
        padding: 0.5rem;
      }
      
      .container {
        padding: 1rem;
        border-radius: 12px;
      }
      
      h1 {
        font-size: 2rem;
        margin-bottom: 1rem;
      }
      
      h2 {
        font-size: 1.3rem;
      }
      
      .meal, .grocery {
        padding: 1rem;
        margin-bottom: 1rem;
      }
      
      .toggle-btn, .swap-btn {
        display: block;
        width: 100%;
        margin: 0.5rem 0;
        padding: 0.8rem;
        font-size: 1rem;
      }
      
      .swap-btn {
        margin-top: 0.5rem;
      }
      
      input[type="text"], input[type="password"] {
        width: 100%;
        margin-bottom: 0.5rem;
        font-size: 16px; /* Prevents zoom on iOS */
      }
      
      button {
        width: 100%;
        margin-top: 0.5rem;
        padding: 1rem;
        font-size: 1rem;
      }
      
      .grocery-header {
        flex-direction: column;
        align-items: stretch;
        gap: 0.5rem;
      }
      
      .grocery-controls {
        justify-content: center;
      }
      
      .grocery-controls button {
        flex: 1;
        max-width: 120px;
      }
      
      .grocery-add-section {
        position: sticky;
        top: 0;
        margin: 0 -1rem 1rem -1rem;
        padding: 1rem;
        border-radius: 0;
      }
      
      .grocery-add-section input {
        flex: 1;
        margin: 0;
        font-size: 16px;
      }
      
      .add-btn {
        width: auto;
        margin: 0;
        padding: 0.8rem 1rem;
      }
      
      .grocery-list {
        max-height: 50vh;
        margin: 0 -0.5rem;
        padding: 0.5rem;
      }
      
      .grocery-item {
        padding: 1.2rem;
        min-height: 70px;
        margin-bottom: 0.2rem;
      }
      
      .grocery-item input[type="checkbox"] {
        transform: scale(1.8);
        margin-right: 1.2rem;
      }
      
      .grocery-item label {
        font-size: 1.1rem;
        line-height: 1.3;
      }
      
      .remove-btn {
        transform: scale(1.2);
        width: 32px;
        height: 32px;
        margin-left: 1rem;
      }
      
      .instructions {
        padding: 1rem;
      }
      
      .instructions li {
        margin-bottom: 1rem;
        line-height: 1.5;
      }
      
      .api-config {
        padding: 1rem;
      }
      
      .api-config input {
        margin-bottom: 1rem;
      }
    }
    
    @media (max-width: 480px) {
      h1 {
        font-size: 1.8rem;
      }
      
      .container {
        padding: 0.75rem;
      }
      
      .meal, .grocery {
        padding: 0.75rem;
      }
      
      .grocery-item {
        padding: 1.5rem 1rem;
        min-height: 80px;
      }
      
      .grocery-item input[type="checkbox"] {
        transform: scale(2);
        margin-right: 1.5rem;
      }
      
      .grocery-item label {
        font-size: 1.2rem;
        font-weight: 500;
      }
      
      .remove-btn {
        transform: scale(1.4);
        width: 36px;
        height: 36px;
      }
    }
    </style>


</head>
<body>
  <div class="container">
    <h1>💚 Heart-Healthy Dinners</h1>
    <p style="text-align: center; color: #718096; font-size: 1.1rem; margin-bottom: 2rem;">Delicious, nutritious meals without fish or onions</p>

    <div class="recipe-controls" style="text-align: center; margin-bottom: 2rem;">
      <label for="recipe-count" style="font-weight: 500; color: #4a5568; margin-right: 1rem;">Show recipes:</label>
      <select id="recipe-count" onchange="updateRecipeDisplay()" style="padding: 0.5rem 1rem; border: 2px solid #e2e8f0; border-radius: 8px; background: white; font-size: 1rem; cursor: pointer;">
        <option value="3">3 recipes</option>
        <option value="5" selected>5 recipes</option>
        <option value="7">7 recipes</option>
        <option value="10">All recipes</option>
      </select>
    </div>

  <div id="meals-container">
    <!-- Meals will be loaded here by JavaScript -->
  </div>

  <div class="grocery-header">
    <h2>🛒 Grocery List</h2>
    <div class="grocery-controls">
      <button id="clear-checked" onclick="clearCheckedItems()">Clear Checked</button>
      <button id="toggle-all" onclick="toggleAllItems()">Check All</button>
      <button id="hide-checked" onclick="toggleHideChecked()">Hide Checked</button>
    </div>
    <div class="sort-controls" style="display: flex; gap: 0.5rem; margin-top: 0.5rem; flex-wrap: wrap; justify-content: center;">
      <button onclick="sortGroceryList('produce')" style="background: linear-gradient(135deg, #48bb78, #38a169); font-size: 0.8rem; padding: 0.4rem 0.8rem;">🥬 Produce</button>
      <button onclick="sortGroceryList('pantry')" style="background: linear-gradient(135deg, #d69e2e, #b7791f); font-size: 0.8rem; padding: 0.4rem 0.8rem;">🥫 Pantry</button>
      <button onclick="sortGroceryList('dairy')" style="background: linear-gradient(135deg, #4299e1, #3182ce); font-size: 0.8rem; padding: 0.4rem 0.8rem;">🥛 Dairy</button>
      <button onclick="sortGroceryList('meat')" style="background: linear-gradient(135df, #e53e3e, #c53030); font-size: 0.8rem; padding: 0.4rem 0.8rem;">🥩 Meat</button>
      <button onclick="sortGroceryList('alphabetical')" style="background: linear-gradient(135deg, #805ad5, #6b46c1); font-size: 0.8rem; padding: 0.4rem 0.8rem;">🔤 A-Z</button>
    </div>
  </div>
  
  <div class="grocery">
    <div class="grocery-add-section">
      <input type="text" id="new-item" placeholder="Add grocery item..." onkeypress="handleAddKeyPress(event)">
      <button onclick="addItem()" class="add-btn">+ Add</button>
    </div>
    
    <div class="grocery-stats">
      <span id="grocery-stats">0 items • 0 checked</span>
    </div>
    
    <div id="grocery-list" class="grocery-list">
      <!-- Items will be populated by JavaScript -->
    </div>
  </div>

  <script src="recipes.js"></script>
  <script>
    function toggleInstructions(button) {
      const mealDiv = button.closest('.meal');
      const instructionsDiv = mealDiv.querySelector('.instructions');
      if (instructionsDiv.style.display === "block") {
        instructionsDiv.style.display = "none";
        button.textContent = "View Instructions";
      } else {
        instructionsDiv.style.display = "block";
        button.textContent = "Hide Instructions";
      }
    }
  
    function addItem() {
      const input = document.getElementById('new-item');
      const value = input.value.trim();
      if (value) {
        // Check if item already exists
        const existingItems = Array.from(document.querySelectorAll('.grocery-item label')).map(label => label.textContent.toLowerCase());
        const itemExists = existingItems.includes(value.toLowerCase());
        
        const div = document.createElement('div');
        div.className = 'grocery-item';
        
        // If duplicate, add a count or indicator
        const displayValue = itemExists ? `${value} (duplicate)` : value;
        
        div.innerHTML = `<input type="checkbox" onchange="updateGroceryStats()"><label onclick="toggleCheckbox(this)">${displayValue}</label><button class="remove-btn" onclick="removeItem(this)">✕</button>`;
        document.getElementById('grocery-list').appendChild(div);
        input.value = '';
        updateGroceryStats();
      }
    }

    function removeItem(button) {
      const item = button.parentElement;
      item.style.transform = 'translateX(100%)';
      item.style.opacity = '0';
      setTimeout(() => {
        item.remove();
        updateGroceryStats();
      }, 300);
    }

    function handleAddKeyPress(event) {
      if (event.key === 'Enter') {
        addItem();
      }
    }

    function toggleCheckbox(label) {
      const checkbox = label.parentElement.querySelector('input[type="checkbox"]');
      checkbox.checked = !checkbox.checked;
      const item = checkbox.parentElement;
      item.classList.toggle('checked', checkbox.checked);
      
      // Handle hide/show logic
      if (hideCheckedItems && checkbox.checked) {
        item.style.display = 'none';
      } else if (!hideCheckedItems) {
        item.style.display = 'flex';
      }
      
      updateGroceryStats();
    }

    function clearCheckedItems() {
      const checkedItems = document.querySelectorAll('.grocery-item input[type="checkbox"]:checked');
      checkedItems.forEach(checkbox => {
        const item = checkbox.parentElement;
        item.style.transform = 'translateX(100%)';
        item.style.opacity = '0';
        setTimeout(() => item.remove(), 300);
      });
      setTimeout(updateGroceryStats, 350);
    }

    function toggleAllItems() {
      const checkboxes = document.querySelectorAll('.grocery-item input[type="checkbox"]');
      const allChecked = Array.from(checkboxes).every(cb => cb.checked);
      
      checkboxes.forEach(checkbox => {
        checkbox.checked = !allChecked;
        checkbox.parentElement.classList.toggle('checked', checkbox.checked);
      });
      updateGroceryStats();
    }

    function updateGroceryStats() {
      const allItems = document.querySelectorAll('.grocery-item');
      const checkedItems = document.querySelectorAll('.grocery-item input[type="checkbox"]:checked');
      const statsElement = document.getElementById('grocery-stats');
      
      if (statsElement) {
        statsElement.textContent = `${allItems.length} items • ${checkedItems.length} checked`;
      }
    }

    function swapRecipe(button) {
      const mealDiv = button.closest('.meal');
      const currentMealId = parseInt(mealDiv.dataset.mealId);
      
      // Find available recipes that aren't currently displayed
      const availableRecipes = recipes.filter(recipe => 
        !currentlyDisplayedRecipes.includes(recipe.id) || recipe.id === currentMealId
      );
      
      // If we only have the current recipe available, don't swap
      if (availableRecipes.length <= 1) {
        alert('No other recipes available to swap!');
        return;
      }
      
      // Get a random recipe from available ones (excluding current)
      const availableIds = availableRecipes.filter(recipe => recipe.id !== currentMealId);
      const randomIndex = Math.floor(Math.random() * availableIds.length);
      const newRecipe = availableIds[randomIndex];
      
      // Update the currently displayed recipes array
      const currentIndex = currentlyDisplayedRecipes.indexOf(currentMealId);
      if (currentIndex !== -1) {
        currentlyDisplayedRecipes[currentIndex] = newRecipe.id;
      }
      
      // Update the meal div with new recipe
      mealDiv.dataset.mealId = newRecipe.id;
      updateRecipe(mealDiv, newRecipe);
      updateShoppingList();
    }

    function updateRecipe(mealDiv, recipe) {
      // Update title
      mealDiv.querySelector('h2').textContent = recipe.title;
      
      // Update instructions div with detailed content
      const instructionsDiv = mealDiv.querySelector('.instructions');
      instructionsDiv.innerHTML = `
        <div style="display: grid; gap: 1rem; margin-bottom: 1rem;">
          <div style="display: flex; gap: 1rem; font-size: 0.9rem; color: #666;">
            <span>⏱️ Prep: ${recipe.prepTime}</span>
            <span>🍳 Cook: ${recipe.cookTime}</span>
            <span>🍽️ Serves: ${recipe.servings}</span>
          </div>
          <div style="background: #e6fffa; padding: 0.8rem; border-radius: 8px; font-size: 0.9rem; color: #2d5a4a;">
            <strong>💚 Heart-Healthy:</strong> ${recipe.healthNote}
          </div>
        </div>
        
        <div style="display: grid; gap: 1rem; grid-template-columns: 1fr 1fr;">
          <div>
            <h4 style="margin: 0 0 0.5rem 0; color: #4a5568;">Ingredients:</h4>
            <ul style="margin: 0; padding-left: 1.2rem; font-size: 0.9rem;">
              ${recipe.ingredients.map(ing => `<li style="margin-bottom: 0.3rem;">${ing}</li>`).join('')}
            </ul>
          </div>
          
          <div>
            <h4 style="margin: 0 0 0.5rem 0; color: #4a5568;">Instructions:</h4>
            <ol style="margin: 0; padding-left: 1.2rem; font-size: 0.9rem;">
              ${recipe.instructions.map(inst => `<li style="margin-bottom: 0.5rem; line-height: 1.4;">${inst}</li>`).join('')}
            </ol>
          </div>
        </div>
        
        <div style="margin-top: 1rem; padding: 0.8rem; background: #fff3cd; border-radius: 8px; font-size: 0.9rem;">
          <strong>📺 Find video tutorials:</strong> 
          <a href="https://www.youtube.com/results?search_query=${encodeURIComponent(recipe.youtubeSearch)}" 
             target="_blank" 
             style="color: #d69e2e; text-decoration: none; margin-left: 0.5rem;">
            Search "${recipe.youtubeSearch}" on YouTube →
          </a>
        </div>
      `;
    }

    let currentlyDisplayedRecipes = [];

    function loadRecipes() {
      const recipeCount = parseInt(document.getElementById('recipe-count').value);
      const mealsContainer = document.getElementById('meals-container');
      
      // Clear existing meals
      mealsContainer.innerHTML = '';
      currentlyDisplayedRecipes = [];
      
      // Get random recipes to display
      const recipesToShow = getRandomRecipes(recipeCount);
      
      recipesToShow.forEach(recipe => {
        const mealDiv = document.createElement('div');
        mealDiv.className = 'meal';
        mealDiv.dataset.mealId = recipe.id;
        
        mealDiv.innerHTML = `
          <h2>${recipe.title}</h2>
          <button class="toggle-btn" onclick="toggleInstructions(this)">View Instructions</button>
          <button class="swap-btn" onclick="swapRecipe(this)" style="margin-left: 1rem; background-color: #e67e22;">Swap Recipe</button>
          <div class="instructions" style="display: none;">
            <!-- Instructions will be populated by updateRecipe -->
          </div>
        `;
        
        mealsContainer.appendChild(mealDiv);
        updateRecipe(mealDiv, recipe);
        currentlyDisplayedRecipes.push(recipe.id);
      });
    }

    function getRandomRecipes(count) {
      if (count >= recipes.length) {
        return [...recipes];
      }
      
      const shuffled = [...recipes].sort(() => 0.5 - Math.random());
      return shuffled.slice(0, count);
    }

    function updateRecipeDisplay() {
      loadRecipes();
      updateShoppingList();
    }

    function updateShoppingList() {
      const groceryList = document.getElementById('grocery-list');
      const ingredientCounts = new Map();
      
      // Get all current recipes and count ingredients
      const meals = document.querySelectorAll('.meal');
      meals.forEach(meal => {
        const mealId = parseInt(meal.dataset.mealId);
        const recipe = recipes[mealId];
        if (recipe && recipe.ingredients) {
          recipe.ingredients.forEach(ingredient => {
            // Normalize ingredient name (remove quantities for grouping)
            const normalizedIngredient = normalizeIngredientName(ingredient);
            const count = ingredientCounts.get(normalizedIngredient) || 0;
            ingredientCounts.set(normalizedIngredient, count + 1);
          });
        }
      });
      
      // Clear current grocery list (except the add item input)
      const existingItems = groceryList.querySelectorAll('.grocery-item');
      existingItems.forEach(item => item.remove());
      
      // Add all ingredients to grocery list with counts
      Array.from(ingredientCounts.entries())
        .sort(([a], [b]) => a.localeCompare(b))
        .forEach(([ingredient, count]) => {
          const div = document.createElement('div');
          div.className = 'grocery-item';
          const displayName = count > 1 ? `${ingredient} (${count})` : ingredient;
          div.innerHTML = `<input type="checkbox" onchange="updateGroceryStats()"><label onclick="toggleCheckbox(this)">${displayName}</label><button class="remove-btn" onclick="removeItem(this)">✕</button>`;
          groceryList.appendChild(div);
        });
      
      updateGroceryStats();
    }

    let hideCheckedItems = false;

    function normalizeIngredientName(ingredient) {
      // Remove common quantity indicators and normalize for grouping
      const normalized = ingredient
        .replace(/^\d+(\s*\/\s*\d+)?\s*(cups?|tbsp|tsp|oz|lbs?|cans?|large|medium|small|boneless|skinless)\s*/i, '') // Handle fractions like 1/2, 1 1/2
        .replace(/^\d+(\s*\/\s*\d+)?\s*/, '') // Remove leading numbers and fractions
        .replace(/\s*\([^)]*\)/, '') // Remove parenthetical info
        .replace(/,.*$/, '') // Remove everything after comma
        .trim()
        .toLowerCase();
      
      // Return original ingredient if normalization results in empty string
      return normalized || ingredient.trim();
    }

    function toggleHideChecked() {
      hideCheckedItems = !hideCheckedItems;
      const button = document.getElementById('hide-checked');
      const checkedItems = document.querySelectorAll('.grocery-item.checked');
      
      if (hideCheckedItems) {
        button.textContent = 'Show Checked';
        checkedItems.forEach(item => {
          item.style.display = 'none';
        });
      } else {
        button.textContent = 'Hide Checked';
        checkedItems.forEach(item => {
          item.style.display = 'flex';
        });
      }
    }

    function categorizeIngredient(ingredient) {
      const lowerIngredient = ingredient.toLowerCase();
      
      // Produce
      if (lowerIngredient.includes('tomato') || lowerIngredient.includes('pepper') || 
          lowerIngredient.includes('spinach') || lowerIngredient.includes('kale') ||
          lowerIngredient.includes('broccoli') || lowerIngredient.includes('carrot') ||
          lowerIngredient.includes('celery') || lowerIngredient.includes('cucumber') ||
          lowerIngredient.includes('zucchini') || lowerIngredient.includes('eggplant') ||
          lowerIngredient.includes('cabbage') || lowerIngredient.includes('avocado') ||
          lowerIngredient.includes('lemon') || lowerIngredient.includes('lime') ||
          lowerIngredient.includes('garlic') || lowerIngredient.includes('sweet potato') ||
          lowerIngredient.includes('mushroom') || lowerIngredient.includes('berry') ||
          lowerIngredient.includes('strawberry') || lowerIngredient.includes('blueberry') ||
          lowerIngredient.includes('banana') || lowerIngredient.includes('parsley') ||
          lowerIngredient.includes('cilantro') || lowerIngredient.includes('basil') ||
          lowerIngredient.includes('mint') || lowerIngredient.includes('greens')) {
        return 'produce';
      }
      
      // Dairy
      if (lowerIngredient.includes('milk') || lowerIngredient.includes('cheese') ||
          lowerIngredient.includes('yogurt') || lowerIngredient.includes('mozzarella') ||
          lowerIngredient.includes('parmesan')) {
        return 'dairy';
      }
      
      // Meat
      if (lowerIngredient.includes('chicken') || lowerIngredient.includes('turkey') ||
          lowerIngredient.includes('beef') || lowerIngredient.includes('pork') ||
          lowerIngredient.includes('fish') || lowerIngredient.includes('salmon')) {
        return 'meat';
      }
      
      // Pantry (default for grains, canned goods, spices, oils, etc.)
      return 'pantry';
    }

    function sortGroceryList(sortType) {
      const groceryList = document.getElementById('grocery-list');
      const items = Array.from(groceryList.querySelectorAll('.grocery-item'));
      
      if (items.length === 0) return;
      
      let sortedItems;
      
      if (sortType === 'alphabetical') {
        sortedItems = items.sort((a, b) => {
          const textA = a.querySelector('label').textContent.toLowerCase();
          const textB = b.querySelector('label').textContent.toLowerCase();
          return textA.localeCompare(textB);
        });
      } else {
        // Sort by category
        const categoryOrder = {
          'produce': 1,
          'dairy': 2,
          'meat': 3,
          'pantry': 4
        };
        
        sortedItems = items.sort((a, b) => {
          const textA = a.querySelector('label').textContent;
          const textB = b.querySelector('label').textContent;
          const categoryA = categorizeIngredient(textA);
          const categoryB = categorizeIngredient(textB);
          
          if (sortType === 'all') {
            // Sort by category first, then alphabetically within category
            if (categoryA !== categoryB) {
              return categoryOrder[categoryA] - categoryOrder[categoryB];
            }
            return textA.toLowerCase().localeCompare(textB.toLowerCase());
          } else if (sortType === categoryA && sortType === categoryB) {
            // Both items are in the requested category, sort alphabetically
            return textA.toLowerCase().localeCompare(textB.toLowerCase());
          } else if (sortType === categoryA) {
            // Item A is in requested category, put it first
            return -1;
          } else if (sortType === categoryB) {
            // Item B is in requested category, put it first
            return 1;
          } else {
            // Neither item is in requested category, maintain original order
            return 0;
          }
        });
      }
      
      // Remove all items and re-add them in sorted order
      items.forEach(item => item.remove());
      sortedItems.forEach(item => groceryList.appendChild(item));
    }

    // Load recipes when page loads
    window.addEventListener('load', () => {
      loadRecipes();
      updateShoppingList();
      
      // Add event listeners for checkbox changes
      document.addEventListener('change', (e) => {
        if (e.target.type === 'checkbox' && e.target.closest('.grocery-item')) {
          const item = e.target.parentElement;
          item.classList.toggle('checked', e.target.checked);
          
          // Handle hide/show logic
          if (hideCheckedItems && e.target.checked) {
            item.style.display = 'none';
          } else if (!hideCheckedItems) {
            item.style.display = 'flex';
          }
        }
      });
    });
    </script>


</body>
</html>
